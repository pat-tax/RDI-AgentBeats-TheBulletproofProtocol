# Docker Compose configuration for local testing
#
# This configuration runs both the green agent (assessor) and
# purple agent (assessee) locally for integration testing.
#
# Port Configuration (aligns with settings.py defaults):
#   Purple: host 9010 → container 9010
#   Green:  host 9009 → container 9009
#
# Environment Configuration:
#   1. Copy .env.example to .env: cp .env.example .env
#   2. Add your OpenAI API key to .env: GREEN_OPENAI_API_KEY=sk-your-actual-key
#   3. Optionally customize ports/timeouts in .env
#
# Note: .env file is optional - containers work with defaults if not present
#
# Usage (with explicit --env-file):
#   docker-compose -f docker-compose-local.yml --env-file .env up -d    # Start both agents
#   docker-compose -f docker-compose-local.yml --env-file .env ps       # Check status
#   docker-compose -f docker-compose-local.yml --env-file .env logs -f  # View logs
#   docker-compose -f docker-compose-local.yml --env-file .env down     # Stop and remove
#
# Alternative env files (dev/prod/test):
#   docker-compose -f docker-compose-local.yml --env-file .env.dev up -d
#   docker-compose -f docker-compose-local.yml --env-file .env.prod up -d

services:
  purple:
    build:
      context: .
      dockerfile: Dockerfile.purple
    platform: linux/amd64
    ports:
      - "${PURPLE_PORT:-9010}:${PURPLE_PORT:-9010}"
    env_file:
      - .env
    environment:
      # Override defaults from .env if needed
      - PURPLE_HOST=0.0.0.0
    networks:
      - agentbeats
    container_name: purple
    restart: unless-stopped

  green:
    build:
      context: .
      dockerfile: Dockerfile.green
    platform: linux/amd64
    ports:
      - "${GREEN_PORT:-9009}:${GREEN_PORT:-9009}"
    env_file:
      - .env
    environment:
      # Override defaults from .env if needed
      - GREEN_HOST=0.0.0.0
      - GREEN_PURPLE_AGENT_URL=http://purple:${PURPLE_PORT:-9010}
    networks:
      - agentbeats
    container_name: green
    restart: unless-stopped
    depends_on:
      - purple

networks:
  agentbeats:
    driver: bridge
